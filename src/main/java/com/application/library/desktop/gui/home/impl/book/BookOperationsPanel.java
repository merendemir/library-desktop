package com.application.library.desktop.gui.home.impl.book;

import com.application.library.desktop.gui.home.impl.book.menu.BooksPopupMenu;
import com.application.library.desktop.gui.home.impl.panel.main.IMainPanel;
import com.application.library.desktop.gui.home.impl.panel.main.IRefreshablePanel;
import com.application.library.desktop.gui.table.CustomDataTable;
import com.application.library.desktop.request.view.book.BookDTO;
import com.application.library.desktop.service.HttpRequestService;
import org.springframework.stereotype.Service;

import javax.swing.*;
import java.awt.*;
import java.awt.event.MouseAdapter;
import java.awt.event.MouseEvent;

@Service
public class BookOperationsPanel extends JPanel implements IMainPanel, IRefreshablePanel {

    private final ShowBooksPanel showBooksPanel;
    private final BooksPopupMenu booksPopupMenu;
    private final HttpRequestService httpRequestService;

    public BookOperationsPanel(BooksPanelCreateService booksPanelCreateService, BooksPopupMenu booksPopupMenu, HttpRequestService httpRequestService) {
        this.showBooksPanel = booksPanelCreateService.createNewBooksPanel();
        this.booksPopupMenu = booksPopupMenu;
        this.httpRequestService = httpRequestService;
        $$$setupUI$$$();

        setLayout(new BorderLayout());
        add(contentPane, BorderLayout.CENTER);

        setComponentActions();
    }

    private void setComponentActions() {
        CustomDataTable booksDataTable = showBooksPanel.getBooksDataTable();
        booksDataTable.addMouseListener(new MouseAdapter() {
            @Override
            public void mouseClicked(MouseEvent e) {
                if (SwingUtilities.isRightMouseButton(e)) {
                    int row = booksDataTable.rowAtPoint(e.getPoint());
                    booksDataTable.setRowSelectionInterval(row, row);

                    BookDTO bookDTO = httpRequestService.getBookById(Long.parseLong(booksDataTable.getSelectedRowId()));

                    booksPopupMenu.setSelectedBook(bookDTO);
                    booksPopupMenu.showPopupMenu(e.getComponent(), e.getX(), e.getY());
                }
            }
        });
    }

    private void createUIComponents() {
        contentPane = showBooksPanel;
    }


    //COMPONENTS
    private JPanel contentPane;

    @Override
    public void selected() {
        showBooksPanel.selected();
    }

    @Override
    public void refreshData() {
        this.selected();
    }

    /**
     * Method generated by IntelliJ IDEA GUI Designer
     * >>> IMPORTANT!! <<<
     * DO NOT edit this method OR call it in your code!
     *
     * @noinspection ALL
     */
    private void $$$setupUI$$$() {
        createUIComponents();
    }

    /**
     * @noinspection ALL
     */
    public JComponent $$$getRootComponent$$$() {
        return contentPane;
    }


}
